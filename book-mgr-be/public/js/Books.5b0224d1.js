(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Books"],{1055:function(e,t,n){"use strict";n.r(t);var a=n("7a23"),c=Object(a["Y"])("data-v-0d212576");Object(a["G"])("data-v-0d212576");var r={key:0},u=Object(a["n"])("h2",null,"图书列表",-1),o={class:"search"},i=Object(a["m"])("添加一条"),l=Object(a["m"])("   "),s=Object(a["m"])("上传 xlsx 批量添加"),b=Object(a["m"])("   "),d=Object(a["m"])("   ");Object(a["E"])();var O=c((function(e,t,n,O,j,f){var p=Object(a["L"])("a-divider"),v=Object(a["L"])("a-input-search"),m=Object(a["L"])("a-button"),h=Object(a["L"])("a-upload"),k=Object(a["L"])("space-between"),w=Object(a["L"])("a-table"),_=Object(a["L"])("a-pagination"),y=Object(a["L"])("flex-end"),g=Object(a["L"])("a-card"),C=Object(a["L"])("add-one"),L=Object(a["L"])("update"),U=Object(a["M"])("only-admin");return Object(a["D"])(),Object(a["j"])("div",null,[Object(a["n"])(g,{title:e.simple?"最近添加的书籍":""},{default:c((function(){return[e.simple?Object(a["k"])("",!0):(Object(a["D"])(),Object(a["j"])("div",r,[u,Object(a["n"])(p),Object(a["n"])(k,null,{default:c((function(){return[Object(a["n"])("div",o,[Object(a["n"])(v,{placeholder:"根据书名搜索","enter-button":"",value:e.keyword,"onUpdate:value":t[1]||(t[1]=function(t){return e.keyword=t}),onSearch:e.onSearch},null,8,["value","onSearch"]),e.isSearch?(Object(a["D"])(),Object(a["j"])("a",{key:0,href:"javascript:;",onClick:t[2]||(t[2]=function(){return e.backAll&&e.backAll.apply(e,arguments)})},"返回")):Object(a["k"])("",!0)]),Object(a["n"])("div",null,[Object(a["X"])(Object(a["n"])(m,{onClick:t[3]||(t[3]=function(t){return e.show=!0})},{default:c((function(){return[i]})),_:1},512),[[U]]),l,Object(a["n"])(h,{action:"".concat(e.domain,"/upload/file"),headers:e.headers,onChange:e.onUploadChange},{default:c((function(){return[Object(a["n"])(m,{type:"primary"},{default:c((function(){return[s]})),_:1})]})),_:1},8,["action","headers","onChange"])])]})),_:1}),Object(a["n"])(p)])),Object(a["n"])(w,{columns:e.columns,"data-source":e.list,pagination:!1,bordered:"",scroll:{x:"max-content"}},Object(a["l"])({publishDate:c((function(t){return[Object(a["m"])(Object(a["O"])(e.formatTimestamp(t.record.publishDate)),1)]})),classify:c((function(t){var n=t.record;return[Object(a["m"])(Object(a["O"])(e.getClassifyTitleById(n.classify)),1)]})),count:c((function(t){return[Object(a["n"])("a",{href:"javascript:; ",onClick:function(n){return e.updateCount("IN_COUNT",t.record)}},"入库",8,["onClick"]),Object(a["m"])(" "+Object(a["O"])(t.record.count)+" ",1),Object(a["n"])("a",{href:"javascript:; ",onClick:function(n){return e.updateCount("OUT_COUNT",t.record)}},"出库",8,["onClick"])]})),_:2},[e.simple?void 0:{name:"actions",fn:c((function(t){return[Object(a["n"])("a",{href:"javascript:;",onClick:function(n){return e.toDetail(t)}},"详情",8,["onClick"]),b,Object(a["X"])(Object(a["n"])("a",{href:"javascript:;",onClick:function(n){return e.update(t)}},"编辑",8,["onClick"]),[[U]]),d,Object(a["X"])(Object(a["n"])("a",{href:"javascript:;",onClick:function(n){return e.remove(t)}},"删除",8,["onClick"]),[[U]])]}))}]),1032,["columns","data-source"]),e.simple?Object(a["k"])("",!0):(Object(a["D"])(),Object(a["j"])(y,{key:1,style:{"margin-top":"24px"}},{default:c((function(){return[Object(a["n"])(_,{current:e.curPage,"onUpdate:current":t[4]||(t[4]=function(t){return e.curPage=t}),total:e.total,"page-size":10,onChange:e.setPage},null,8,["current","total","onChange"])]})),_:1}))]})),_:1},8,["title"]),Object(a["n"])(C,{show:e.show,"onUpdate:show":t[5]||(t[5]=function(t){return e.show=t}),classifyList:e.bookClassifyList,onGetList:e.getList},null,8,["show","classifyList","onGetList"]),Object(a["n"])(L,{show:e.showUpdateModal,"onUpdate:show":t[6]||(t[6]=function(t){return e.showUpdateModal=t}),book:e.curEditBook,onUpdate:e.updateCurBook},null,8,["show","book","onUpdate"])])})),j=n("1da1"),f=(n("7db0"),n("99af"),n("96cf"),n("8e44")),p=n("6c02"),v=n("f64c"),m=n("ed3b"),h=n("b558"),k=n("e428"),w=n("8808"),_=n("f2fa");n("b0c0");function y(e,t,n,c,r,u){var o=Object(a["L"])("a-input"),i=Object(a["L"])("a-form-item"),l=Object(a["L"])("a-input-number"),s=Object(a["L"])("a-date-picker"),b=Object(a["L"])("a-select-option"),d=Object(a["L"])("a-select"),O=Object(a["L"])("a-form"),j=Object(a["L"])("a-modal");return Object(a["D"])(),Object(a["j"])("div",null,[Object(a["n"])(j,{title:"添加书籍",visible:e.props.show,onOk:e.submit,onCancel:e.close},{default:Object(a["W"])((function(){return[Object(a["n"])(O,{"label-col":{span:6}},{default:Object(a["W"])((function(){return[Object(a["n"])(i,{label:"书名"},{default:Object(a["W"])((function(){return[Object(a["n"])(o,{value:e.addForm.name,"onUpdate:value":t[1]||(t[1]=function(t){return e.addForm.name=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"价格"},{default:Object(a["W"])((function(){return[Object(a["n"])(l,{value:e.addForm.price,"onUpdate:value":t[2]||(t[2]=function(t){return e.addForm.price=t}),min:0,max:1e10},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"作者"},{default:Object(a["W"])((function(){return[Object(a["n"])(o,{value:e.addForm.author,"onUpdate:value":t[3]||(t[3]=function(t){return e.addForm.author=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"出版日期"},{default:Object(a["W"])((function(){return[Object(a["n"])(s,{value:e.addForm.publishDate,"onUpdate:value":t[4]||(t[4]=function(t){return e.addForm.publishDate=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"分类"},{default:Object(a["W"])((function(){return[Object(a["n"])(d,{value:e.addForm.classify,"onUpdate:value":t[5]||(t[5]=function(t){return e.addForm.classify=t}),style:{width:"120px"}},{default:Object(a["W"])((function(){return[(Object(a["D"])(!0),Object(a["j"])(a["b"],null,Object(a["J"])(e.store.bookClassify,(function(e){return Object(a["D"])(),Object(a["j"])(b,{key:e._id,value:e._id},{default:Object(a["W"])((function(){return[Object(a["m"])(Object(a["O"])(e.title),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1}),Object(a["n"])(i,{label:"库存"},{default:Object(a["W"])((function(){return[Object(a["n"])(o,{value:e.addForm.count,"onUpdate:value":t[6]||(t[6]=function(t){return e.addForm.count=t})},null,8,["value"])]})),_:1})]})),_:1})]})),_:1},8,["visible","onOk","onCancel"])])}var g=n("4360"),C={name:"",price:0,author:"",publishDate:0,classify:"",count:""},L=Object(a["o"])({props:{show:Boolean},setup:function(e,t){var n=Object(a["H"])(Object(k["a"])(C));g["a"].state.bookClassify.length&&(n.classify=g["a"].state.bookClassify[0]._id);var c=function(){var e=Object(j["a"])(regeneratorRuntime.mark((function e(){var a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=Object(k["a"])(n),a.publishDate=n.publishDate.valueOf(),e.next=4,f["b"].add(a);case 4:c=e.sent,Object(k["c"])(c).success((function(e,a){var c=a.data;Object.assign(n,C),v["a"].success(c.msg),t.emit("getList")}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r=function(){t.emit("update:show",!1)};return{addForm:n,submit:c,props:e,close:r,store:g["a"].state}}});L.render=y;var U=L,x=n("7ba4"),D=Object(a["o"])({components:{AddOne:U,Update:x["a"]},props:{simple:Boolean},setup:function(e){var t=new p["d"],n=[{title:"书名",dataIndex:"name"},{title:"价格",dataIndex:"price"},{title:"作者",dataIndex:"author"},{title:"库存",slots:{customRender:"count"}},{title:"出版日期",dataIndex:"publishDate",slots:{customRender:"publishDate"}},{title:"分类",slots:{customRender:"classify"}}];e.simple||n.push({title:"操作",slots:{customRender:"actions"}});var c=Object(a["I"])(!1),r=Object(a["I"])(!1),u=Object(a["I"])([]),o=Object(a["I"])(0),i=Object(a["I"])(1),l=Object(a["I"])(""),s=Object(a["I"])(!1),b=Object(a["I"])({}),d=function(){var e=Object(j["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["b"].list({page:i.value,size:10,keyword:l.value});case 2:t=e.sent,Object(k["c"])(t).success((function(e){var t=e.data,n=t.list,a=t.total;u.value=n,o.value=a}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a["A"])(Object(j["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:d();case 1:case"end":return e.stop()}}),e)}))));var O=function(e){i.value=e,d()},y=function(){d(),s.value=Boolean(l.value)},g=function(){l.value="",d(),s.value=!1},C=function(){var e=Object(j["a"])(regeneratorRuntime.mark((function e(t){var n,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.text,a=n._id,e.next=4,f["b"].remove(a);case 4:c=e.sent,Object(k["c"])(c).success((function(e){var t=e.msg;v["a"].success(t),d()}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(e,t){var n="增加";"OUT_COUNT"===e&&(n="减少"),m["a"].confirm({title:"要".concat(n,"多少库存"),content:Object(a["n"])("div",null,[Object(a["n"])(h["a"],{class:"__book_input_count"},null)]),onOk:function(){var a=Object(j["a"])(regeneratorRuntime.mark((function a(){var c,r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return c=document.querySelector(".__book_input_count"),r=c.value,a.next=4,f["b"].updateCount({id:t._id,num:r,type:e});case 4:o=a.sent,Object(k["c"])(o).success((function(a){r="IN_COUNT"===e?Math.abs(r):-Math.abs(r);var c=u.value.find((function(e){return e._id===t._id}));c&&(c.count=c.count+r,v["a"].success("成功".concat(n," ").concat(Math.abs(r)," 本书")))}));case 6:case"end":return a.stop()}}),a)})));function c(){return a.apply(this,arguments)}return c}()})},U=function(e){var t=e.record;r.value=!0,b.value=t},x=function(e){Object.assign(b.value,e)},D=function(e){var n=e.record;t.push("/books/".concat(n._id))},F=function(e){var t=e.file;t.response&&Object(k["c"])(t.response).success(function(){var e=Object(j["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["b"].addMany(t);case 2:n=e.sent,Object(k["c"])(n).success((function(e){var t=e.data.addCount;v["a"].success("成功添加 ".concat(t," 本书")),d()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())};return{columns:n,show:c,list:u,formatTimestamp:k["b"],curPage:i,total:o,setPage:O,keyword:l,onSearch:y,backAll:g,isSearch:s,remove:C,updateCount:L,showUpdateModal:r,update:U,curEditBook:b,updateCurBook:x,toDetail:D,getList:d,getClassifyTitleById:w["a"],simple:e.simple,onUploadChange:F,headers:Object(_["d"])(),domain:_["b"]}}});n("1e25");D.render=O,D.__scopeId="data-v-0d212576";t["default"]=D},"1e25":function(e,t,n){"use strict";n("50d2")},"50d2":function(e,t,n){},"7ba4":function(e,t,n){"use strict";n("b0c0");var a=n("7a23");function c(e,t,n,c,r,u){var o=Object(a["L"])("a-input"),i=Object(a["L"])("a-form-item"),l=Object(a["L"])("a-input-number"),s=Object(a["L"])("a-date-picker"),b=Object(a["L"])("a-select-option"),d=Object(a["L"])("a-select"),O=Object(a["L"])("a-form"),j=Object(a["L"])("a-modal");return Object(a["D"])(),Object(a["j"])("div",null,[Object(a["n"])(j,{title:"添加书籍",visible:e.props.show,onOk:e.submit,onCancel:e.close},{default:Object(a["W"])((function(){return[Object(a["n"])(O,{"label-col":{span:6}},{default:Object(a["W"])((function(){return[Object(a["n"])(i,{label:"书名"},{default:Object(a["W"])((function(){return[Object(a["n"])(o,{value:e.editForm.name,"onUpdate:value":t[1]||(t[1]=function(t){return e.editForm.name=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"价格"},{default:Object(a["W"])((function(){return[Object(a["n"])(l,{value:e.editForm.price,"onUpdate:value":t[2]||(t[2]=function(t){return e.editForm.price=t}),min:0,max:1e10},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"作者"},{default:Object(a["W"])((function(){return[Object(a["n"])(o,{value:e.editForm.author,"onUpdate:value":t[3]||(t[3]=function(t){return e.editForm.author=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"出版日期"},{default:Object(a["W"])((function(){return[Object(a["n"])(s,{value:e.editForm.publishDate,"onUpdate:value":t[4]||(t[4]=function(t){return e.editForm.publishDate=t})},null,8,["value"])]})),_:1}),Object(a["n"])(i,{label:"分类"},{default:Object(a["W"])((function(){return[Object(a["n"])(d,{value:e.editForm.classify,"onUpdate:value":t[5]||(t[5]=function(t){return e.editForm.classify=t}),style:{width:"120px"}},{default:Object(a["W"])((function(){return[(Object(a["D"])(!0),Object(a["j"])(a["b"],null,Object(a["J"])(e.store.bookClassify,(function(e){return Object(a["D"])(),Object(a["j"])(b,{key:e._id,value:e._id},{default:Object(a["W"])((function(){return[Object(a["m"])(Object(a["O"])(e.title),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1})]})),_:1})]})),_:1},8,["visible","onOk","onCancel"])])}var r=n("1da1"),u=(n("96cf"),n("a9e3"),n("8e44")),o=n("f64c"),i=n("e428"),l=n("c1df"),s=n.n(l),b=n("4360"),d=(n("6ee9"),Object(a["o"])({props:{show:Boolean,book:Object},setup:function(e,t){var n=Object(a["H"])({name:"",price:0,author:"",publishDate:0,classify:""}),c=function(){t.emit("update:show",!1)};Object(a["U"])((function(){return e.book}),(function(e){Object.assign(n,e),n.publishDate=s()(Number(n.publishDate))}));var l=function(){var a=Object(r["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,u["b"].update({id:e.book._id,name:n.name,price:n.price,author:n.author,publishDate:n.publishDate.valueOf(),classify:n.classify});case 2:r=a.sent,Object(i["c"])(r).success((function(e){var n=e.data,a=e.msg;t.emit("update",n),o["a"].success(a),c()}));case 4:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();return{editForm:n,submit:l,props:e,close:c,store:b["a"].state}}}));d.render=c;t["a"]=d},8808:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n("7db0");var a=n("4360"),c=function(e){var t=a["a"].state.bookClassify.find((function(t){return t._id===e}));return t&&t.title||"未知分类"}}}]);
//# sourceMappingURL=Books.5b0224d1.js.map